<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚¹ãƒ†ãƒ¼ã‚¸ 11</title>

  <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ« -->
  <link rel="stylesheet" href="css/style.css" />
</head>


<body>

  <!-- ===== Tutorial Modal ===== -->
  <div id="tutorialBackdrop" class="modal-backdrop hidden"></div>
  <div id="tutorialModal" class="modal hidden">
    <div class="modal-content">
      <button class="modal-close" onclick="closeTutorialModal()">Ã—</button>
      <h2 class="tut-title">ã‚¹ãƒ†ãƒ¼ã‚¸èª¬æ˜</h2>
      <div class="tut-body"></div>
      <div class="modal-footer">
        <button class="modal-ok" onclick="closeTutorialModal()">OK</button>
      </div>
    </div>
  </div>

  <!-- ===== Clear Modal ===== -->
  <div id="clearBackdrop" class="modal-backdrop hidden"></div>
  <div id="clearModal" class="modal hidden">
    <div class="modal-content">
      <button class="modal-close" onclick="closeClearModal()">Ã—</button>
      <h2 class="clear-title">ã‚³ãƒ¼ã‚¹ã‚¯ãƒªã‚¢ï¼ğŸ‰</h2>
      <div class="clear-body">
        ãŠã‚ã§ã¨ã†ï¼<br>
        ãƒ–ãƒ­ãƒƒã‚¯æ•° <span id="clearSteps"></span> æ‰‹ã§ã‚´ãƒ¼ãƒ«ã§ããŸã‚ˆï¼
      </div>
      <div class="modal-footer">
        <button class="modal-replay" onclick="replayStage()">ã‚‚ã†ä¸€å›ãƒ—ãƒ¬ã‚¤</button>
        <a id="nextStageBtn" class="modal-next" href="#">æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸</a>
        <button class="modal-ok" onclick="closeClearModal()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <!-- ---------- HEADER ---------- -->
  <header>
    <button class="back-btn" onclick="location.href='index.html'">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
    <div>ã‚¹ãƒ†ãƒ¼ã‚¸ 11</div>
    <div class="header-right">
      <a id="headerNextBtn" class="pane-toggle hidden" href="#">â–¶ æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸</a>
      <button id="toggleGameBtn" class="pane-toggle" aria-pressed="false">â¹ ã‚²ãƒ¼ãƒ éè¡¨ç¤º</button>
    </div>
  </header>


  <!-- ---------- MAIN ---------- -->
  <div class="container">
    <!-- Blockly -->
    <div class="left-panel" id="blocklyDiv"></div>

    <!-- Game -->
    <div class="right-panel">
      <canvas id="gameCanvas" width="600" height="600"></canvas>

      <div class="btn-box">
        <button class="game-btn" id="runBtn">å®Ÿè¡Œ</button>
        <button class="game-btn" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <div id="statusBar"></div>
    </div>
  </div>

  <!-- ---------- SCRIPT LOAD ---------- -->
  <!-- (1) ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒãƒƒãƒ— -->
  <script src="stages/stage11-map.js"></script>

  <!-- (2) Blockly CDN -->
  <script src="https://cdn.jsdelivr.net/npm/blockly@10.4.3/blockly_compressed.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/blockly@10.4.3/blocks_compressed.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/blockly@10.4.3/javascript_compressed.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/blockly@10.4.3/msg/ja.js"></script>

  <!-- (3) ãƒ–ãƒ­ãƒƒã‚¯å®šç¾©ï¼‹ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆæœŸåŒ– -->
  <script src="js/blockly-setup.js"></script>

  <!-- (4) å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆfail/successãªã©ï¼‰ -->
  <script src="js/util.js"></script>

  <!-- (5) ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæç”»ãƒ»ç§»å‹•ï¼‰ -->
  <script src="js/logic.js"></script>

  <script>
    (function () {
      const btn = document.getElementById('toggleGameBtn');

      // å‰å›çŠ¶æ…‹ã‚’å¾©å…ƒ
      const hidden = localStorage.getItem('hideGame') === '1';
      if (hidden) applyHiddenState(true);

      btn.addEventListener('click', () => {
        const nowHidden = document.body.classList.toggle('hide-game');
        applyHiddenState(nowHidden);
        localStorage.setItem('hideGame', nowHidden ? '1' : '0');

        if (window.Blockly && window.workspace) {
          Blockly.svgResize(window.workspace);
        }
      });

      window.addEventListener('resize', () => {
        if (window.Blockly && window.workspace) {
          Blockly.svgResize(window.workspace);
        }
      });

      function applyHiddenState(isHidden) {
        btn.textContent = isHidden ? 'â–¶ï¸ ã‚²ãƒ¼ãƒ è¡¨ç¤º' : 'â¹ ã‚²ãƒ¼ãƒ éè¡¨ç¤º';
        btn.setAttribute('aria-pressed', isHidden.toString());
      }
    })();

    window.addEventListener('DOMContentLoaded', () => {
      const nextBtn = document.getElementById('headerNextBtn');
      if (nextBtn) {
        nextBtn.classList.remove('show-next');
        nextBtn.classList.add('hidden');
        nextBtn.style.display = ''; // å¿µã®ãŸã‚ãƒªã‚»ãƒƒãƒˆ
      }
    });


  </script>
  <script src="js/no-ui-bgm.js"></script>
  <script>
    setupNoUiBGM('assets/bgm/game.mp3', { startMuted: true });
  </script>

</body>

</html>